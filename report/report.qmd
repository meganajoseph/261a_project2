---
title: "Project 2"
author: "Megan Joseph"
thanks: "Project repository available at: [https://github.com/meganajoseph/261a_project2](https://github.com/meganajoseph/261a_project2)."
date: today
date-format: long
abstract: ""
format: pdf
bibliography: references.bib
number-sections: true
---

# Introduction {#sec-intro}

the motivation for the analysis

Can college readiness, staff demographics, and school demographics predict graduation rates in California high schools?

a brief overview of the broader context

the knowledge gap that is addressed by the paper

what was done in the analysis

the key findings and why they are important

the structure of the paper

This project draws from the data sources Common Core of Data, Small Area Income and Poverty Estimates, The Civil Rights Data Collection, ED*Facts*, Integrated Postsecondary Education Data System, College Scorecard, National Historical Geographic Information System, Federal Student Aid, National Association of College and University Business Officers, National Center for Charitable Statistics, Model Estimates of Poverty in Schools (MEPS), Equity in Athletics Data (EADA), and Campus Safety and Security [@Data_about].

# Data {#sec-data}

```{r}
#| include: false
#| warning: false
#| message: false

# load libraries
library(tidyverse)
library(dplyr)
library(patchwork)
#library(ggpubr)
#library(ggplot2)
#library(ggtext)
#library(tidyr)

# load data
schools <- read.csv("../data/EducationDataPortal_11.16.2025_Schools.csv")
dd <- read.csv("../data/EducationDataPortal_11.16.2025_datadictionary.csv")

schools_int_var <- schools %>% dplyr::select(enrollment, title_i_eligible, suspensions_instances, enrl_IB, enrl_gifted_talented, enrl_AP, students_AP_exam_oneormore, students_SAT_ACT, teachers_fte_crdc, teachers_first_year_fte, instructional_aides_fte, counselors_fte, salaries_teachers, grad_rate_midpt)

schools_int_var$enrl_IB[is.na(schools_int_var$enrl_IB)] <- 0
schools_int_var$enrl_gifted_talented[is.na(schools_int_var$enrl_gifted_talented)] <- 0
schools_int_var$enrl_AP[is.na(schools_int_var$enrl_AP)] <- 0

cleaned_schools <- schools_int_var %>% filter(enrollment > 0 &
                                                (title_i_eligible == "Yes" | title_i_eligible == "No") &
                                                suspensions_instances >= 0 &
                                                grad_rate_midpt != "" & grad_rate_midpt != "Suppressed data" &
                                                salaries_teachers != "Not applicable") 

cleaned_schools$grad_rate_midpt <- as.numeric(cleaned_schools$grad_rate_midpt)
cleaned_schools$salaries_teachers <- as.numeric(cleaned_schools$salaries_teachers)

cleaned_schools$prop_IB <- cleaned_schools$enrl_IB / cleaned_schools$enrollment
cleaned_schools$prop_IB[is.na(cleaned_schools$prop_IB)] <- 0

cleaned_schools$prop_gat <- cleaned_schools$enrl_gifted_talented / cleaned_schools$enrollment

cleaned_schools$prop_gat[is.na(cleaned_schools$prop_gat)] <- 0

cleaned_schools$prop_ap <- cleaned_schools$enrl_AP / cleaned_schools$enrollment
cleaned_schools$prop_ap[is.na(cleaned_schools$prop_ap)] <- 0

cleaned_schools$prop_adv <- (cleaned_schools$enrl_AP + cleaned_schools$enrl_gifted_talented + cleaned_schools$enrl_IB) / cleaned_schools$enrollment
```

The data are from the Education Data Explorer from the Urban Institute's Center on Education Data and Policy. This tool compiles data from national data sources on schools, districts, and colleges in order to assist in creating insights to improve student outcomes [@Data_about].

I used this [query](https://educationdata.urban.org/data-explorer/explorer/?educationLevel=K-12&dataLevel=Schools&fipsNumbers=6&startYear=2016&endYear=2017&schoolLevel=high_cedp&charterSchoolOptions=1%2C0&timeframeType=date-range&togglesList=24-78%2C24-79%2C24-86%2C24-88%2C24-89%2C24-90%2C24-91%2C24-92%2C24-95%2C24-96%2C24-37%2C24-47%2C24-48%2C24-49%2C37-19%2C46-9%2C46-10%2C46-11%2C46-12%2C46-13%2C46-14%2C53-15%2C53-16%2C111-1349%2C49-1411%2C120-1333%2C120-1334%2C107-1326%2C107-1327%2C107-1328%2C107-1329%2C107-1330%2C107-1331%2C107-1332%2C118-1352%2C118-1354%2C118-1356%2C118-1358%2C118-1360%2C118-1362%2C118-1364%2C118-1366%2C118-1368%2C118-1369%2C118-1370%2C118-1371%2C118-1372%2C118-1373%2C118-1374%2C118-1375%2C28-97%2C60-98%2C24-100%2C24-101%2C24-102%2C24-103%2C127-1412%2C69-20%2C69-21%2C69-22%2C115-23%2C119-24%2C69-26%2C69-27%2C69-28%2C69-32%2C69-33%2C69-34%2C41-61%2C41-62%2C41-63%2C41-64%2C41-65%2C42-66%2C42-67%2C42-68%2C42-69%2C42-70%2C42-71%2C110-1335%2C110-1336%2C110-1337%2C110-1338%2C110-1339%2C110-1340%2C110-1341%2C110-1342%2C110-1343%2C110-1344%2C110-1345%2C110-1346%2C110-1347%2C110-1348%2C76-1%2C76-2%2C76-5%2C76-6%2C100-1138%2C52-1311%2C52-1312%2C52-1313%2C52-1314%2C52-1316%2C52-1318%2C123-1407%2C52-1319%2C123-1408%2C52-1320%2C123-1409%2C52-1321%2C52-1322%2C52-1323%2C52-1324%2C52-1325%2C123-1400%2C123-1401%2C123-1403%2C123-1404) to produce a dataset of high schools in California from 2016-2017 with information on school characteristics, absenteeism, college readiness, course offerings, student demographics, discipline, school safety, student outcomes, and teachers and staff [@Data]. The observational unit is an individual high school in California. The key variables of interest are student enrollment, whether or not a school is eligible for participation in either Target Assistance program or school-wide program authorized by Title I of Public Law 103-382, the number of students enrolled in the International Baccalaureate Diploma Program, the number of students enrolled in the gifted and talented programs, the number of students enrolled in at least one AP course, the number of students who took one or more AP exams, the number of students participating in the SAT and ACT tests, the number of suspensions, the number of full-time teachers, the number of first-year teachers, the number of full-time equivalent instructional aides or paraprofessionals, the number of full-time equivalent school counselors, and teacher salary.

Removing all NA values would result in an empty dataset, so I removed a few of them and left the for variables like number of students enrolled in the IB program because that would most likely mean it is not offered at that school while another program like AP is offered. After removing these, the dataset has `r nrow(cleaned_schools)` observations while the original has `r nrow(schools)` observations.

## Common Core of Data {#sec-cc}

```{r fig-ccd}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Plot (a) shows a scatter plot of the graduation rate over the number of students enrolled. Plot (b) shows a boxplot of graduation rate at Title I eligible and ineligible schools."

enrl <- ggplot(data=cleaned_schools, aes(x=enrollment, y=grad_rate_midpt)) + 
  geom_point() +
  labs(x="Number of students enrolled", y="Graduation rate", title="Comparison of the number\nof students enrolled in\nCalifornia high schools\nand graduation rate (a)") +
  theme_minimal()

title1 <- ggplot(data=cleaned_schools, aes(x=title_i_eligible, y=grad_rate_midpt)) + 
  geom_boxplot() +
  labs(x="Title I eligible", y="Graduation rate", title="Comparison of graduation\nrate between Title I eligible\nand ineligible California\nhigh schools (b)") + 
  theme_minimal()

enrl + title1
```

The variables student enrollment and Title I eligibility are sourced from Common Core of Data (CCD) [@Data]. The CCD is the United States Department of Education's database on all public elementary and secondary schools and school districts [@CCD].

Student enrollment reports the number of students enrolled in the school. @fig-ccd (a) shows a logarithmic relationship, so a log transformation should be applied. A school is Title I eligible if it is in a school district for children from low-income families [@NCES]. @fig-ccd (b) shows that schools that are not Title I eligible have a higher median graduation rate and is less varied, whereas schools that are Title I eligible are much more varied with a larger number of outliers. I picked these variables because small schools have been linked to higher graduation rates, and students from low-income families tend to have higher dropout rates [@HP2030].

## The Civil Rights Data Collection {#sec-crdc}

```{r fig-crdc-1}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "A scatter plot showing the relationship between the proportion of students enrolled in high level courses including the IB program (purple), AP program (pink), and gifted and talented programs (blue) (x-axis) and graduation rate (y-axis)."

colors <- c("Proportion enrolled in IB" = "purple", "Proportion enrolled in gifted\nand talented" = "skyblue", "Proportion enrolled in AP" = "violetred")
ggplot() +
geom_point(data=cleaned_schools, aes(x=prop_IB, y=grad_rate_midpt, color="Proportion enrolled in IB"), alpha=0.2) +
  geom_point(data=cleaned_schools, aes(x=prop_gat, y=grad_rate_midpt, color="Proportion enrolled in gifted\nand talented"), alpha=0.2) +
  geom_point(data=cleaned_schools, aes(x=prop_ap, y=grad_rate_midpt, color="Proportion enrolled in AP"), alpha=0.2) +
  labs(x="Proportion of students enrolled in higher level courses", y="Graduation rate", title="Comparison of students enrolled in higher level courses and\ngraduation rate", color="Legend") +
  scale_color_manual(values=colors) +
  theme_minimal()
```

```{r}
#| echo: false
#| warning: false
#| message: false

ggplot(data=cleaned_schools, aes(x=prop_adv, y=grad_rate_midpt)) +
  geom_point()

```

```{r fig-crdc-2}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Plot (a) shows a scatter plot of the graduation rate over the number of students taking at least one AP exam. Plot (b) shows a scatter plot of the graduation rate over the number of students taking either the SAT or ACT."

ap <- ggplot(data=cleaned_schools, aes(x=students_AP_exam_oneormore, y=grad_rate_midpt)) + 
  geom_point() +
  labs(x="Number of students taking at least\none AP exam", y="Graduation rate", title="Comparison of the number\nof students taking at least\none AP exam and graduation\nrate (a)") +
  theme_minimal()

sat <- ggplot(data=cleaned_schools, aes(x=students_SAT_ACT, y=grad_rate_midpt)) + 
  geom_point() +
  labs(x="Number of students taking the SAT\nor ACT", y="Graduation rate", title="Comparison of the number\nof students taking at the\nSAT or ACT and graduation\nrate (b)") + 
  theme_minimal()

ap + sat

```

```{r fig-crdc-3}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "This shows the relationship between the number of suspensions in a school (x-axis) and graduation rate (y-axis)."

ggplot(data=cleaned_schools, aes(x=suspensions_instances, y=grad_rate_midpt)) +
  geom_point() +
  labs(x="Number of suspensions", y="Graduation rate", title="Comparison of the number of suspensions and graduation\nrate") + 
  theme_minimal()
```

```{r fig-crdc-4, fig.width=8, fig.height=8}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Plot (a) shows the relationship between the number of full-time teachers (x-axis) and graduation rate (y-axis). Plot (b) shows the relationship between the number of first year teachers (x-axis) and graduation rate (y-axis). Plot (c) shows the relationship between the number of instructional aides and paraprofessionals (x-axis) and graduation rate (y-axis). Plot (d) shows the relationship between the number of counselors (x-axis) and graduation rate (y-axis). Plot (e) shows the relationship between teacher salary (x-axis) and graduation rate (y-axis)."

ftt <- ggplot(data=cleaned_schools, aes(x=teachers_fte_crdc, y=grad_rate_midpt)) + 
geom_point() +
  labs(x="Number of full-time teachers", y="Graduation rate", title="Comparison of the number of full-time\nteachers and graduation rate (a)") +
  theme_minimal()

fyt <- ggplot(data=cleaned_schools, aes(x=teachers_first_year_fte, y=grad_rate_midpt)) +
  geom_point() +
  labs(x="Number of first year teachers", y="Graduation rate", title="Comparison of the number of first year\nteachers and graduation rate (b)") +
  theme_minimal()

fta <- ggplot(data=cleaned_schools, aes(x=instructional_aides_fte, y=grad_rate_midpt)) +
  geom_point() +
  labs(x="Number of instructional aides and paraprofessionals", y="Graduation rate", title="Comparison of the number of\ninstructional aides and paraprofessionals\nand graduation rate (c)") +
  theme_minimal()

ftc <- ggplot(data=cleaned_schools, aes(x=counselors_fte, y=grad_rate_midpt)) + 
  geom_point() +
  labs(x="Number of counselors", y="Graduation rate", title="Comparison of the number of counselors\nand graduation rate (d)") +
  theme_minimal()

ts <- ggplot(data=cleaned_schools, aes(x=salaries_teachers, y=grad_rate_midpt)) + 
  geom_point() +
  labs(x="Salaries of teachers", y="Graduation rate", title="Comparison of the salaries of teachers and graduation rate (e)") +
  theme_minimal() 
  
(ftt + fyt) / (fta + ftc) / ts
```

The Civil Rights Data Collection (CRDC) comes from the United States Department of Education's Office for Civil Rights. This data is collection in order to ensure schools give students equal access to educational opportunities [@CRDC]. Data are collected from public schools and districts, justice facilities, charter schools, alternative schools, and special education schools [@CRDC].

The variables from this dataset are the number of students enrolled in the International Baccalaureate Diploma Program, the number of students enrolled in the gifted and talented programs, the number of students enrolled in at least one AP course, the number of students that took one or more AP exams, the number of students participating in the SAT or ACT, the number of suspensions, the number of full-time teachers, number of first-year teachers, number of full-time equivalent instructional aides or paraprofessionals, number of full-time equivalent school counselors, and teacher salary. The number of students enrolled in the International Baccalaureate Diploma Program, the number of students enrolled in the gifted and talented programs, and the number of students enrolled in at least one AP course were transformed to the proportion of students enrolled in each respective program because that is more informative. @fig-crdc-1 shows a logarithmic relationship between these programs and graduation rate. @fig-crdc-2, @fig-crdc-3, @fig-crdc-4, and @fig-crdc-5 also show logarithmic relationships between the selected variables and graduation rate, so a log transformation is appropriate.

I picked these variables because students participating in higher level courses and/or participating in college-preparatory exams would be most interested in graduating and going to college. Suspensions would make it more difficult for students to graduate. Increased support from experienced teachers and other aides can motivate students to do well in school. Higher teacher salary will motivate teachers to put more effort in helping their students.

## ED*Facts* {#sec-edfacts}

High school graduation rate comes from the ED*Facts* dataset. ED*Facts* collects and analyzes data from pre-kindergarten through twelfth grade supplied by state education agencies with other data within the U.S. Department of Education [@EDFacts].

## Alternative Data Sources

A good alternate data source would be at the student level rather than the school level. This can be difficult to find, though, because the students are not legal adults and due to Family Educational Rights and Privacy Act (FERPA) which protects the distribution of educational records without the consent of parents or the student if they are over 18 years old. Information on absenteeism, family income level, extracurriculars of the students, involvement of parents and teachers, and reading level would also help in predicting graduation rates.

# Methods {#sec-methods}

```{r}
#| echo: false
#| warning: false
#| message: false

# split into training/tst
library("tidymodels")
schools_split <- initial_validation_split(cleaned_schools, prop=c(0.7, 0.15))

train <- training(schools_split)
valid <- validation(schools_split)
test <- testing(schools_split)

base <- lm(grad_rate_midpt ~ enrollment + title_i_eligible + enrl_IB + enrl_AP + enrl_gifted_talented + students_AP_exam_oneormore + students_SAT_ACT + suspensions_instances + teachers_fte_crdc + teachers_first_year_fte + instructional_aides_fte + counselors_fte + salaries_teachers, data=train)
```

In an attempt to answer this research question, I will first fit a multiple linear regression model using all variables and no transformations. Let $Y_i$ represent the graduation rate at an individual school. Let $X_{i1}$ represent the number of students enrolled at that school, $X_{i2}$ equal 1 if a school is Title I eligible and 0 if it's not, $X_{i3}$ represent the number of students enrolled in the International Baccalaureate Diploma Program, $X_{i4}$ represent the number of students enrolled in the AP program, $X_{i5}$ represent the number of students enrolled in the gifted and talented program, $X_{i6}$ represent the number of students that took one or more AP exams, $X_{i7}$ represent the number of students participating in the SAT or ACT, $X_{i8}$ represent the number of suspensions, $X_{i9}$ represent the number of full-time teachers, $X_{i,10}$ represent the number of first-year teachers, $X_{i, 11}$ represent the number of full-time equivalent instructional aides or paraprofessionals, $X_{i, 12}$ represent the number of full-time equivalent school counselors, and $X_{i, 13}$ represent teacher salary.

The model can we written as $$Y_i = \beta_0 + \beta_1 X_{i1} + \beta_2 X_{i2} + \beta_3 X_{i3} + \beta_4 X_{i4} + \beta_5 X_{i5} + \beta_6 X_{i6} + \beta_7 X_{i7} + \beta_8 X_{i8} + \beta_9 X_{i9} + \beta_{10} X_{i,10} + \beta_{11} X_{i,11} + \beta_{12} X_{i,12} + \beta_{13} X_{i,13} + \varepsilon_i \text{ for i = 1, ..., n}$$ where $\beta_0$ represents the mean of the probability distribution of the graduation rate when all predictors are 0, $\beta_1$ represents the average change in graduation rate for an additional student enrolled, holding all other variables constant, $\beta_2$ represents the average change in graduation rate for a Title I school, holding all other predictors constant, $\beta_3$ represents the average change in graduation rate for an additional student enrolled in the IB program, holding all other variables constant, $\beta_4$ represents the average change in graduation rate for an additional student enrolled in the AP program, holding all other variables constant, $\beta_5$ represents the average change in graduation rate for an additional student enrolled in the gifted and talented program, holding all other variables constant, $\beta_6$ represents the average change in graduation rate for an additional student that took one or more AP exams, holding all other variables constant, $\beta_7$ represents the average change in graduation rate for an additional student participating in the SAT or ACT, holding all other variables constant, $\beta_8$ represents the average change in graduation rate for an additional suspension instance, holding all other variables constant, $\beta_9$ represents the average change in graduation rate for an additional full-time teacher, holding all other variables constant, $\beta_{10}$ represents the average change in graduation rate for an additional first-year teacher, holding all other variables constant, $\beta_{11}$ represents the average change in graduation rate for an additional full-time equivalent instructional aide or paraprofessional, holding all other variables constant, $\beta_{12}$ represents the average change in graduation rate for an additional full-time equivalent school counselor, holding all other variables constant, $\beta_{13}$ represents the average change in graduation rate for a one USD increase in teacher salary, holding all other variables constant, $n$ is the number of schools in the dataset, and $\varepsilon_i$ represents the error.

The assumptions for linear regression are:

1.  The variables used accurately reflect the quantities of interest, the model should include all predictors, and the model should be applicable for the research question.
2.  The sample data is representative of the population of interest.
3.  The mean function must be correct.
4.  Errors must be independent.
5.  The variance of the errors must be equal.
6.  Errors must be normal.

present any model or statistical methods clearly using mathematical notation and plain English explanations.

Every symbol and component of the model should be introduced and described.

This section must clearly describe any relevant assumptions and whether they are met.

Describe possible limitations of your analysis.

describe the software used for implementation

include any necessary steps taken for model selection and validation.

# Results {#sec-results}

describe the fitted model and its implications.\
This section should include relevant tables, graphs, and quantitative results, as well as plain English explanations of all of these components.

Clearly explain what the model results show and connect your results to the central research question(s) and their broader context

# Discussion {#sec-disc}

A brief summary of the paper

Discussion of your key findings and what their implications are for your research question

Discussion of some potential weaknesses of your study

Identification of potential improvements and extensions or future areas of related research.

# Questions

1.  can't remove all NAs without getting an empty dataset. what to do?
2.  should i be having this many graphs?? does figure 2 look ok
3.  still confused about interaction, esp how to check
4.  should i put a graph of the log transformations?
5.  do i need to make a graph or anything for graduation rate?
6.  instead of seeing if there is enrollment in either ap, ib, or other program, should i do any program at all? (get issue with students being in multiple programs)
7.  can i write the model in matrix form or does it have to be all written out. if latter how to get math to not go off the page
8.  are the assumptions different?
9.  if i know there is a log relationship, should i start start with the most basic model or do a transformation as the first model?

# References {#sec-ref}
